const images=["./img/photos/image2.png","./img/photos/image3.png","./img/photos/image4.jpg","./img/photos/image5.jpg","./img/photos/image7.png","./img/photos/image8.png","./img/photos/image9.png"];let currentIndex=0;const imageDisplay=document.getElementById("imageDisplay"),prevButton=document.getElementById("prevButton"),nextButton=document.getElementById("nextButton"),imageCounter=document.getElementById("imageCounter");function updateButtonState(){prevButton.disabled=0===currentIndex,nextButton.disabled=currentIndex===images.length-1,prevButton.style.opacity=prevButton.disabled?"0.5":"1",nextButton.style.opacity=nextButton.disabled?"0.5":"1"}function updateImageCounter(){imageCounter.innerHTML=`<span class="red-bold">${currentIndex+1}</span>/${images.length}`}function changeImage(e){let t=document.createElement("img");t.src=images[currentIndex],t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.opacity="1",t.style.transition="opacity 0.5s ease",imageDisplay.parentNode.appendChild(t),imageDisplay.style.opacity="0",setTimeout(()=>{currentIndex=e,imageDisplay.src=images[currentIndex],imageDisplay.style.opacity="1",t.remove(),updateImageCounter(),updateButtonState()},500)}imageDisplay&&prevButton&&nextButton?(prevButton.addEventListener("click",()=>{currentIndex>0&&changeImage(currentIndex-1)}),nextButton.addEventListener("click",()=>{currentIndex<images.length-1&&changeImage(currentIndex+1)})):console.error("Элементы не найдены. Проверьте IDs в HTML."),updateButtonState(),updateImageCounter(),document.addEventListener("DOMContentLoaded",()=>{let e="true"===localStorage.getItem("isAdmin"),t=document.getElementById("logoutButton"),n=document.getElementById("button1"),a=document.getElementById("button2"),r=document.getElementById("button3"),i=document.getElementById("addOilChangeCardButton"),o=document.getElementById("addDiagnosticsCardButton"),l=document.getElementById("addSparePartsCardButton"),s=document.getElementById("createCardButton"),d=document.getElementById("closeModal"),c=document.getElementById("addCardModal"),u=document.getElementById("cardTitle"),g=document.getElementById("cardDescription"),p=document.getElementById("cardImage"),y=document.getElementById("cardPrice"),m="oil-change";function v(e){n.classList.remove("active"),a.classList.remove("active"),r.classList.remove("active"),e.classList.add("active")}function h(e){let t=document.querySelectorAll(".card");t.forEach(t=>{t.style.display=t.dataset.category===e?"block":"none"})}function w(t){i.style.display="oil-change"===t&&e?"block":"none",o.style.display="diagnostics"===t&&e?"block":"none",l.style.display="spare-parts"===t&&e?"block":"none"}e||(i.style.display="none",o.style.display="none",l.style.display="none",s.style.display="none",document.querySelectorAll(".deleteCardButton").forEach(e=>{e.style.display="none"})),e&&(t.style.display="block"),t.addEventListener("click",()=>{localStorage.removeItem("isAdmin"),alert("Вы вышли из админ-панели"),window.location.reload()}),n.addEventListener("click",()=>{v(n),h(m="oil-change"),w(m)}),a.addEventListener("click",()=>{v(a),h(m="diagnostics"),w(m)}),r.addEventListener("click",()=>{v(r),h(m="spare-parts"),w(m)});let I=()=>{let e={"oil-change":"Замена масла",diagnostics:"Диагностика","spare-parts":"Запчасти"},t=document.getElementById("modalCategoryInfo");t.textContent=`Категория: ${e[m]||"Неизвестно"}`,c.style.display="block"};function E(){u.value="",g.value="",p.value="",y.value=""}async function $(t){let n=await f(),a=n.some(e=>e.title===t.title&&e.price===t.price&&e.category===t.category);if(a){alert("Эта карточка уже существует в данной категории!");return}let r=document.createElement("div");r.classList.add("card"),r.dataset.category=t.category;let i=t.price.trim()+" ₽";r.innerHTML=`
        <img src="${t.imgSrc}" alt="Product Image">
        <div class="card-content">
            <h3>${t.title}</h3>
            <p>${t.description}</p>
        </div>
        <a href="https://wapp.click/79202159937" class="catalog-button" target="_blank" rel="noopener noreferrer">${i}</a>
        <button class="deleteCardButton" style="display: ${e?"block":"none"}">Удалить</button>
    `,document.querySelector(".catalog-cards").appendChild(r),h(t.category);let o=r.querySelector(".deleteCardButton");o.addEventListener("click",()=>{x(t.title,t.price,r)});try{let l=await fetch("http://localhost:3000/api/cards",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!l.ok)throw Error("Network response was not ok");let s=await l.json();console.log("Card added successfully:",s)}catch(d){console.error("Error adding card:",d)}}async function f(){try{let e=await fetch("http://localhost:3000/api/cards");if(!e.ok)throw Error("Network response was not ok");return await e.json()}catch(t){return console.error("Error fetching cards:",t),[]}}i.addEventListener("click",()=>{m="oil-change",I()}),o.addEventListener("click",()=>{m="diagnostics",I()}),l.addEventListener("click",()=>{m="spare-parts",I()}),d.addEventListener("click",()=>{c.style.display="none",E()}),window.addEventListener("click",e=>{e.target===c&&(c.style.display="none",E())}),s.addEventListener("click",()=>{let e=p.files[0],t=new FileReader;t.onload=function(e){let t={category:m,title:u.value,description:g.value,price:y.value,imgSrc:e.target.result};$(t),c.style.display="none",E()},e?t.readAsDataURL(e):alert("Пожалуйста, выберите изображение.")});let B=async()=>{let e=await f();e.forEach(e=>{C(e)}),h(m)};function C(t){let n=document.createElement("div");n.classList.add("card"),n.dataset.category=t.category,n.innerHTML=`
            <img src="${t.imgSrc}" alt="Product Image">
            <div class="card-content">
                <h3>${t.title}</h3>
                <p>${t.description}</p>
            </div>
            <a href="https://wapp.click/79202159937" class="catalog-button" target="_blank" rel="noopener noreferrer">${t.price.trim()} ₽</a>
            <button class="deleteCardButton" style="display: ${e?"block":"none"}">Удалить</button>
        `,document.querySelector(".catalog-cards").appendChild(n);let a=n.querySelector(".deleteCardButton");a.addEventListener("click",()=>{x(t.title,t.price,n)})}function x(e,t,n){fetch(`http://localhost:3000/api/cards/${encodeURIComponent(e)}`,{method:"DELETE"}).then(e=>{e.ok?n.remove():console.error("Ошибка при удалении карточки")}).catch(e=>console.error("Error deleting card:",e))}B(),v(n),w(m)});const reviewContainer=document.querySelector(".reviews-container"),reviewCards=document.querySelectorAll(".review-card");let reviewIndex=0,itemsToShow=3,swipeItemsToShow=2;function updateItemsToShow(){window.innerWidth<961?(itemsToShow=swipeItemsToShow,toggleNavigationButtons(!1)):(itemsToShow=3,toggleNavigationButtons(!0)),reviewIndex=0,updateCards()}function toggleNavigationButtons(e){document.getElementById("prev").style.display=e?"block":"none",document.getElementById("next").style.display=e?"block":"none"}function updateNavigationButtons(){document.getElementById("prev").disabled=0===reviewIndex,document.getElementById("next").disabled=reviewIndex+itemsToShow>=reviewCards.length}function updateCards(){reviewCards.forEach(e=>{e.style.display="none",e.style.opacity="0",e.style.transform="translateX(0)"});for(let e=0;e<itemsToShow;e++){let t=reviewIndex+e;t<reviewCards.length&&(reviewCards[t].style.display="flex",setTimeout(()=>{reviewCards[t].style.opacity="1",reviewCards[t].style.transform="translateX(0)"},50))}updateNavigationButtons()}let startX;function nextReview(){if(reviewIndex+itemsToShow<reviewCards.length){let e=Array.from(reviewCards).slice(reviewIndex,reviewIndex+itemsToShow);e.forEach(e=>{e.style.opacity="0",e.style.transform="translateX(-100%)"}),reviewIndex+=itemsToShow,setTimeout(()=>{updateCards()},300)}}function previousReview(){if(reviewIndex>0){let e=Array.from(reviewCards).slice(reviewIndex,reviewIndex+itemsToShow);e.forEach(e=>{e.style.opacity="0",e.style.transform="translateX(100%)"}),reviewIndex=Math.max(0,reviewIndex-itemsToShow),setTimeout(()=>{updateCards()},300)}}function init(){var e=new ymaps.Map("map",{center:[50.667855,40.041014],zoom:15}),t=new ymaps.Placemark([50.667855,40.041014],{hintContent:"Мы на картах",balloonContent:"Революции, 22 с. Лосево"});e.geoObjects.add(t)}function copyToClipboard(e,t){navigator.clipboard.writeText(e).then(()=>{let n=document.getElementById(t);n?(n.textContent="Скопировано!",setTimeout(()=>{n.textContent=e},500)):console.error("Элемент не найден")}).catch(e=>{console.error("Ошибка при копировании: ",e)})}reviewContainer.addEventListener("touchstart",e=>{window.innerWidth<961&&(startX=e.touches[0].clientX)}),reviewContainer.addEventListener("touchmove",e=>{if(window.innerWidth<961){let t=e.touches[0].clientX,n=startX-t;n>50&&reviewIndex+swipeItemsToShow<reviewCards.length?(nextReview(),startX=t):n<-50&&reviewIndex>0&&(previousReview(),startX=t)}}),updateItemsToShow(),window.addEventListener("resize",updateItemsToShow),document.getElementById("next").addEventListener("click",()=>{nextReview()}),document.getElementById("prev").addEventListener("click",()=>{previousReview()}),updateItemsToShow(),window.addEventListener("resize",updateItemsToShow),ymaps.ready(init),document.addEventListener("DOMContentLoaded",function(){let e=document.querySelector(".intro"),t=["bg1","bg2","bg3"],n=0;setInterval(function a(){e.classList.remove(t[n]),n=(n+1)%t.length,e.classList.add(t[n])},5e3)}),function(){let e=document.querySelector(".burger"),t=document.querySelector(".header__nav"),n=document.querySelector(".header__nav-close"),a=document.querySelectorAll(".header__link");e.addEventListener("click",()=>{t.classList.add("header__nav_active")}),n.addEventListener("click",()=>{t.classList.remove("header__nav_active")}),a.forEach(e=>{e.addEventListener("click",()=>{t.classList.remove("header__nav_active")})})}(),function(){let e=function(e,t){let n=document.querySelector(".header").clientHeight,a=document.querySelector(e).getBoundingClientRect().top-n,r=window.pageYOffset,i=null,o=function(e){var n,l,s,d;null===i&&(i=e);let c=e-i,u=(n=c,l=r,s=a,d=t,(n/=d/2)<1?s/2*n*n+l:-s/2*(--n*(n-2)-1)+l);window.scrollTo(0,u),c<t&&requestAnimationFrame(o)};requestAnimationFrame(o)};!function(){let t=document.querySelectorAll(".js-scroll");t.forEach(t=>{t.addEventListener("click",function(){let t=this.getAttribute("href");e(t,1e3)})})}()}();